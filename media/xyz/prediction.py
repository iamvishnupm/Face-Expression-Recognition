# -*- coding: utf-8 -*-
"""prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1y9T4x0gB3f8qlAi6DIc2Dme8YFLb3pL7
"""

import os
import cv2
import numpy as np

import torch
from .models import CustomMobileNet

torch.cuda.is_available()

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
device

model = CustomMobileNet(7)
model = torch.load("model.pth")
model = model.to(device)

path = "C:/Users/Rey/Desktop/Projects/raf-db/pred"
img_list = os.listdir(path)
img_list

from PIL import Image
from torchvision import transforms

transform = transforms.Compose(
    [
        transforms.Resize((128, 128)),
        transforms.ToTensor(),
        transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225]),
    ]
)

labels = ["angry", "disgust", "fear", "happy", "neutral", "sad", "surprise"]

from matplotlib import pyplot

# len(img_list)
fig, axes = pyplot.subplots(nrows=1, ncols=7, figsize=(56, 8))

for img, ax in zip(img_list, axes.flatten()):
    img_path = os.path.join(path, img)
    image = Image.open(img_path)
    ax.imshow(image)

    image = transform(image).unsqueeze(0)
    image = image.to(device)

    with torch.no_grad():
        out = model(image)
        _, pred = torch.max(out, 1)

    ax.set_xlabel(labels[pred.item()], fontsize=60)


pyplot.tight_layout()
pyplot.show()
